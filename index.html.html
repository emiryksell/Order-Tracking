<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sipari≈ü Takip Sistemi Pro</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Mono:wght@500;700&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }

      body {
        font-family: "Poppins", sans-serif;

        /* Arka Plan */
        background: linear-gradient(
            rgba(15, 23, 42, 0.7),
            rgba(15, 23, 42, 0.9)
          ),
          url("https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?q=80&w=2070&auto=format&fit=crop");

        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;

        height: 100vh;
        overflow: hidden;
        color: #333;
      }

      .container {
        display: flex;
        height: 100vh;
      }

      /* Sidebar */
      .sidebar {
        width: 260px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(15px);
        padding: 25px;
        display: flex;
        flex-direction: column;
        gap: 15px;
        box-shadow: 5px 0 25px rgba(0, 0, 0, 0.1);
        z-index: 100;
      }

      .logo {
        font-size: 26px;
        font-weight: 700;
        color: #667eea;
        text-align: center;
        padding: 10px 0 30px 0;
        border-bottom: 1px solid #f1f5f9;
        margin-bottom: 10px;
        letter-spacing: -0.5px;
      }

      .menu-btn {
        background: transparent;
        border: none;
        padding: 16px 20px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 15px;
        font-weight: 500;
        font-family: "Poppins", sans-serif;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 12px;
        color: #64748b;
        text-align: left;
      }

      .menu-btn:hover {
        background: #f1f5f9;
        color: #667eea;
        transform: translateX(5px);
      }

      .menu-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      /* Main Content */
      .main-content {
        flex: 1;
        padding: 30px;
        padding-right: 420px;
        overflow-y: auto;
      }

      .header {
        background: rgba(255, 255, 255, 0.9);
        padding: 20px 30px;
        border-radius: 16px;
        margin-bottom: 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
      }

      .header h1 {
        color: #1e293b;
        font-size: 24px;
        font-weight: 600;
      }

      .stats {
        display: flex;
        gap: 20px;
      }

      .stat-box {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 12px 25px;
        border-radius: 12px;
        text-align: center;
        min-width: 140px;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
      }

      .stat-box .label {
        font-size: 12px;
        opacity: 0.9;
        font-weight: 500;
        margin-bottom: 4px;
      }

      .stat-box .value {
        font-family: "Roboto Mono", monospace;
        font-size: 22px;
        font-weight: 700;
      }

      /* Tables Grid */
      .tables-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 25px;
        margin-bottom: 20px;
      }

      /* MASA KARTI STƒ∞LLERƒ∞ */
      .table-card {
        background: rgba(255, 255, 255, 0.95);
        padding: 20px;
        border-radius: 16px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 5px solid transparent; /* KALIN KENARLIK */
        position: relative;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 160px;
      }

      .table-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        background: white;
      }

      .table-card.available {
        border-color: rgba(226, 232, 240, 0.8);
      }
      .table-card.available .table-number {
        color: #64748b;
      }

      /* PULSE ANƒ∞MASYONU */
      @keyframes strong-pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
        }
        70% {
          box-shadow: 0 0 0 15px rgba(239, 68, 68, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
        }
      }

      /* DOLU MASA */
      .table-card.occupied {
        border-color: #f87171;
        background: rgba(254, 226, 226, 0.95);
        animation: strong-pulse 2s infinite;
      }
      .table-card.occupied .table-number {
        color: #dc2626;
      }

      /* SE√áƒ∞Lƒ∞ MASA */
      .table-card.selected {
        border-color: #667eea;
        background: rgba(255, 255, 255, 1);
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
        transform: scale(1.02);
        animation: none;
      }

      /* HEM DOLU HEM SE√áƒ∞Lƒ∞ */
      .table-card.occupied.selected {
        border-color: #f87171 !important;
        background: rgba(254, 226, 226, 1) !important;
        animation: strong-pulse 2s infinite;
        transform: scale(1.02);
      }

      .table-number {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 8px;
      }

      .table-status {
        font-size: 11px;
        font-weight: 600;
        color: #94a3b8;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .table-total {
        font-family: "Roboto Mono", monospace;
        font-size: 16px;
        font-weight: 700;
        color: #333;
        margin-top: 12px;
        background: #f1f5f9;
        padding: 6px 12px;
        border-radius: 20px;
        display: inline-block;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        border: 1px solid #e2e8f0;
      }

      .table-card.occupied .table-total {
        background: white;
        color: #dc2626;
        border-color: #fee2e2;
      }

      /* Order Panel */
      .order-panel {
        position: fixed;
        right: 20px;
        top: 20px;
        bottom: 20px;
        width: 380px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 25px;
        box-shadow: -10px 0 30px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        z-index: 900;
      }

      .panel-header {
        padding-bottom: 20px;
        border-bottom: 1px solid #f1f5f9;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
      }

      .panel-header h2 {
        color: #1e293b;
        font-size: 20px;
        margin-bottom: 5px;
      }

      .panel-header .subtitle {
        color: #64748b;
        font-size: 13px;
      }

      .panel-close-btn {
        background: #f1f5f9;
        border: none;
        width: 32px;
        height: 32px;
        border-radius: 10px;
        cursor: pointer;
        color: #64748b;
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }

      .panel-close-btn:hover {
        background: #ef4444;
        color: white;
      }

      .order-items {
        flex: 1;
        overflow-y: auto;
        margin-bottom: 20px;
        padding-right: 5px;
      }

      .order-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        border-radius: 12px;
        margin-bottom: 12px;
        background: #f8fafc;
        border: 1px solid #f1f5f9;
        transition: all 0.2s ease;
      }

      .order-item:hover {
        border-color: #cbd5e1;
        background: white;
      }

      .item-info {
        flex: 1;
      }
      .item-name {
        font-weight: 600;
        color: #333;
        font-size: 14px;
        margin-bottom: 4px;
      }
      .item-note {
        font-size: 11px;
        color: #94a3b8;
        font-style: italic;
      }

      .item-controls {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 0 15px;
        background: white;
        padding: 4px;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
      }

      .qty-btn {
        width: 24px;
        height: 24px;
        border: none;
        border-radius: 6px;
        background: #f1f5f9;
        color: #333;
        cursor: pointer;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }

      .qty-btn:hover {
        background: #667eea;
        color: white;
      }
      .qty-display {
        width: 20px;
        text-align: center;
        font-weight: 600;
        font-size: 13px;
        font-family: "Roboto Mono", monospace;
      }
      .item-price {
        font-family: "Roboto Mono", monospace;
        font-weight: 700;
        color: #667eea;
        font-size: 15px;
        min-width: 60px;
        text-align: right;
      }
      .delete-btn {
        background: transparent;
        border: none;
        color: #cbd5e1;
        cursor: pointer;
        font-size: 18px;
        margin-left: 10px;
        transition: color 0.2s;
      }
      .delete-btn:hover {
        color: #ef4444;
      }

      .total-section {
        background: #f8fafc;
        padding: 20px;
        border-radius: 16px;
        margin-bottom: 20px;
        border: 1px solid #f1f5f9;
      }

      .total-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 14px;
        color: #64748b;
      }
      .total-row.grand {
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px dashed #cbd5e1;
        font-size: 20px;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 0;
      }
      .total-row.grand span:last-child {
        font-family: "Roboto Mono", monospace;
        color: #667eea;
      }

      .action-buttons {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      .btn {
        padding: 16px;
        border: none;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
        font-family: "Poppins", sans-serif;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
      .btn:active {
        transform: scale(0.98);
      }
      .btn-primary {
        grid-column: span 2;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }
      .btn-primary:hover {
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        transform: translateY(-2px);
      }
      .btn-success {
        background: #10b981;
        color: white;
      }
      .btn-success:hover {
        background: #059669;
        box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
      }
      .btn-danger {
        background: #fee2e2;
        color: #ef4444;
      }
      .btn-danger:hover {
        background: #fecaca;
        color: #dc2626;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(15, 23, 42, 0.7);
        backdrop-filter: blur(4px);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 20px;
        width: 90%;
        max-width: 600px;
        max-height: 85vh;
        overflow-y: auto;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      /* Arama Kutusu Stili */
      .search-input {
        width: 100%;
        padding: 12px 12px 12px 45px;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        font-family: "Poppins", sans-serif;
        font-size: 14px;
        outline: none;
        background: #f8fafc;
        transition: all 0.2s;
      }
      .search-input:focus {
        border-color: #667eea;
        background: white;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .category-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 25px;
        flex-wrap: wrap;
        padding-bottom: 15px;
        border-bottom: 1px solid #f1f5f9;
      }
      .category-tab {
        padding: 10px 20px;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        background: white;
        cursor: pointer;
        font-family: "Poppins", sans-serif;
        font-size: 14px;
        font-weight: 500;
        color: #64748b;
        transition: all 0.2s;
      }
      .category-tab:hover {
        background: #f8fafc;
      }
      .category-tab.active {
        background: #667eea;
        color: white;
        border-color: #667eea;
      }

      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 15px;
      }
      .product-card {
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: center;
        background: white;
      }
      .product-card:hover {
        border-color: #667eea;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        transform: translateY(-3px);
      }
      .product-emoji {
        font-size: 40px;
        margin-bottom: 10px;
        display: block;
      }
      .product-name {
        font-weight: 600;
        margin-bottom: 5px;
        font-size: 14px;
        color: #333;
      }
      .product-price {
        font-family: "Roboto Mono", monospace;
        color: #667eea;
        font-weight: 700;
      }

      .note-input {
        width: 100%;
        padding: 15px;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        margin-top: 20px;
        font-size: 14px;
        font-family: "Poppins", sans-serif;
        background: #f8fafc;
      }
      .note-input:focus {
        outline: none;
        border-color: #667eea;
        background: white;
      }

      /* Reports View */
      .reports-view {
        display: none;
      }
      .report-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 25px;
        margin-bottom: 30px;
      }
      .report-card {
        background: rgba(255, 255, 255, 0.95);
        padding: 25px;
        border-radius: 16px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border: 1px solid #f1f5f9;
      }
      .report-card h3 {
        color: #64748b;
        font-size: 14px;
        margin-bottom: 12px;
        font-weight: 500;
      }
      .report-card .value {
        font-family: "Roboto Mono", monospace;
        font-size: 28px;
        font-weight: 700;
        color: #667eea;
      }
      .history-list {
        background: rgba(255, 255, 255, 0.95);
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #94a3b8;
      }
      .empty-state-icon {
        font-size: 48px;
        margin-bottom: 15px;
        opacity: 0.5;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="sidebar">
        <div class="logo">üçΩÔ∏è RestoPOS</div>
        <button class="menu-btn active" onclick="switchView('tables')">
          <span>üìã</span> Masalar & Sipari≈ü
        </button>
        <button class="menu-btn" onclick="switchView('reports')">
          <span>üìä</span> Raporlar
        </button>
        <div style="flex: 1"></div>
        <button
          class="menu-btn"
          onclick="resetAllData()"
          style="color: #ef4444"
        >
          <span>üîÑ</span> Sistemi Sƒ±fƒ±rla
        </button>
      </div>

      <div class="main-content">
        <div id="tablesView" class="tables-view">
          <div class="header">
            <h1>Masa Y√∂netimi</h1>
            <div class="stats">
              <div class="stat-box">
                <div class="label">Aktif Masa</div>
                <div class="value" id="activeTables">0</div>
              </div>
              <div class="stat-box">
                <div class="label">G√ºnl√ºk Gelir</div>
                <div class="value" id="dailyRevenue">‚Ç∫0</div>
              </div>
            </div>
          </div>

          <div class="tables-grid" id="tablesGrid"></div>
        </div>

        <div id="reportsView" class="reports-view">
          <div class="header">
            <h1>Raporlar ve ƒ∞statistikler</h1>
          </div>

          <div class="report-cards">
            <div class="report-card">
              <h3>Toplam Satƒ±≈ü</h3>
              <div class="value" id="totalSales">‚Ç∫0</div>
            </div>
            <div class="report-card">
              <h3>Toplam Sipari≈ü</h3>
              <div class="value" id="totalOrders">0</div>
            </div>
            <div class="report-card">
              <h3>Ortalama Hesap</h3>
              <div class="value" id="avgCheck">‚Ç∫0</div>
            </div>
            <div class="report-card">
              <h3>En √áok Satan</h3>
              <div class="value" id="topProduct">-</div>
            </div>
          </div>

          <div class="history-list">
            <h2 style="margin-bottom: 25px; font-size: 18px">Son Sipari≈üler</h2>
            <div id="historyList"></div>
          </div>
        </div>
      </div>

      <div class="order-panel" id="orderPanel" style="display: none">
        <div class="panel-header">
          <div>
            <h2 id="panelTableName">Masa Se√ßilmedi</h2>
            <p class="subtitle" id="panelTableStatus">
              Sipari≈ü almak i√ßin masa se√ßin
            </p>
          </div>
          <button class="panel-close-btn" onclick="closeOrderPanel()">√ó</button>
        </div>

        <div class="order-items" id="orderItems">
          <div class="empty-state">
            <div class="empty-state-icon">üõí</div>
            <p>Sepet bo≈ü</p>
          </div>
        </div>

        <div class="total-section">
          <div class="total-row">
            <span>Ara Toplam</span>
            <span id="subtotal">‚Ç∫0.00</span>
          </div>
          <div class="total-row grand">
            <span>TOPLAM</span>
            <span id="grandTotal">‚Ç∫0.00</span>
          </div>
        </div>

        <div class="action-buttons">
          <button class="btn btn-primary" onclick="openProductModal()">
            ‚ûï Sipari≈ü Ekle
          </button>
          <button class="btn btn-success" onclick="completeOrder()">
            üí≥ √ñdeme Al
          </button>
          <button class="btn btn-danger" onclick="clearTable()">
            üóëÔ∏è ƒ∞ptal
          </button>
        </div>
      </div>
    </div>

    <div class="modal" id="productModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>√úr√ºn Se√ßimi</h2>
          <button class="panel-close-btn" onclick="closeProductModal()">
            &times;
          </button>
        </div>

        <div style="margin-bottom: 15px; position: relative">
          <span
            style="
              position: absolute;
              left: 15px;
              top: 50%;
              transform: translateY(-50%);
              color: #94a3b8;
            "
            >üîç</span
          >
          <input
            type="text"
            id="searchInput"
            class="search-input"
            placeholder="√úr√ºn ara..."
            onkeyup="filterProducts()"
          />
        </div>

        <div class="category-tabs" id="categoryTabs"></div>
        <div class="products-grid" id="productsGrid"></div>
        <input
          type="text"
          class="note-input"
          id="orderNote"
          placeholder="Sipari≈ü notu ekle... (√ñrn: Soƒüansƒ±z)"
        />

        <button
          class="btn btn-primary"
          style="width: 100%; margin-top: 20px; padding: 18px"
          onclick="closeProductModal()"
        >
          ‚úÖ Se√ßimi Tamamla
        </button>
      </div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <script>
      const PRODUCTS = {
        Yemekler: [
          { name: "Pizza Margherita", price: 250, emoji: "üçï" },
          { name: "Pizza Karƒ±≈üƒ±k", price: 275, emoji: "üçï" },
          { name: "Hamburger", price: 200, emoji: "üçî" },
          { name: "Cheeseburger", price: 175, emoji: "üçî" },
          { name: "Tavuk D√∂ner", price: 100, emoji: "üåØ" },
          { name: "Et D√∂ner", price: 150, emoji: "üåØ" },
        ],
        ƒ∞√ßecekler: [
          { name: "Kola", price: 50, emoji: "ü•§" },
          { name: "Fanta", price: 50, emoji: "ü•§" },
          { name: "Ice Tea", price: 40, emoji: "üßÉ" },
          { name: "Su", price: 10, emoji: "üíß" },
          { name: "Ayran", price: 25, emoji: "ü•õ" },
        ],
        Sƒ±caklar: [
          { name: "T√ºrk Kahvesi", price: 50, emoji: "‚òï" },
          { name: "Espresso", price: 70, emoji: "‚òï" },
          { name: "Latte", price: 70, emoji: "‚òï" },
          { name: "Cappuccino", price: 70, emoji: "‚òï" },
          { name: "√áay", price: 15, emoji: "üçµ" },
        ],
        Tatlƒ±lar: [
          { name: "S√ºtla√ß", price: 75, emoji: "üçÆ" },
          { name: "Kazandibi", price: 75, emoji: "üçÆ" },
          { name: "Profiterol", price: 80, emoji: "üç∞" },
          { name: "Tiramisu", price: 80, emoji: "üç∞" },
        ],
      };

      let state = {
        tables: {},
        selectedTable: null,
        currentView: "tables",
        history: [],
        dailyStats: { revenue: 0, orders: 0 },
      };

      let currentCategory = "Yemekler";

      async function init() {
        await loadState();
        renderTables();
        renderCategoryTabs();
        renderProducts();
        updateStats();
      }

      async function loadState() {
        try {
          const saved = await localStorage.getItem("restaurant_state");
          if (saved) {
            const data = JSON.parse(saved);
            state = { ...state, ...data };
          }
        } catch (e) {
          console.log("Veri y√ºkleme hatasƒ± veya ilk a√ßƒ±lƒ±≈ü");
        }

        if (!state.tables || Object.keys(state.tables).length === 0) {
          state.tables = {};
          for (let i = 1; i <= 12; i++) {
            state.tables[i] = { orders: [], total: 0 };
          }
        }

        if (!state.history) state.history = [];
        if (!state.dailyStats) state.dailyStats = { revenue: 0, orders: 0 };
      }

      async function saveState() {
        try {
          await localStorage.setItem("restaurant_state", JSON.stringify(state));
        } catch (e) {
          console.error("Kayƒ±t hatasƒ±:", e);
        }
      }

      function renderTables() {
        const grid = document.getElementById("tablesGrid");
        grid.innerHTML = "";

        for (let i = 1; i <= 12; i++) {
          const table = state.tables[i];
          const hasOrders = table.orders.length > 0;

          const card = document.createElement("div");
          card.className = `table-card ${hasOrders ? "occupied" : "available"}`;
          if (state.selectedTable === i) card.classList.add("selected");

          card.innerHTML = `
                    <div class="table-number">Masa ${i}</div>
                    <div class="table-status">${
                      hasOrders ? "DOLU" : "BO≈û"
                    }</div>
                    ${
                      hasOrders
                        ? `<div class="table-total">‚Ç∫${table.total.toFixed(
                            2
                          )}</div>`
                        : ""
                    }
                `;

          card.onclick = () => selectTable(i);
          grid.appendChild(card);
        }
      }

      function selectTable(id) {
        state.selectedTable = id;
        document.getElementById("orderPanel").style.display = "flex";
        document.getElementById("panelTableName").textContent = `Masa ${id}`;
        document.getElementById("panelTableStatus").textContent =
          state.tables[id].orders.length > 0
            ? "Sipari≈üler g√∂r√ºnt√ºleniyor"
            : "Yeni sipari≈ü olu≈üturuluyor";

        renderTables();
        renderOrderItems();
      }

      function closeOrderPanel() {
        document.getElementById("orderPanel").style.display = "none";
        state.selectedTable = null;
        renderTables();
      }

      function renderOrderItems() {
        const container = document.getElementById("orderItems");
        const table = state.tables[state.selectedTable];

        if (table.orders.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üõí</div>
                        <p>Hen√ºz sipari≈ü eklenmedi</p>
                    </div>
                `;
        } else {
          container.innerHTML = table.orders
            .map(
              (item, idx) => `
                    <div class="order-item">
                        <div class="item-info">
                            <div class="item-name">${item.name}</div>
                            ${
                              item.note
                                ? `<div class="item-note">Not: ${item.note}</div>`
                                : ""
                            }
                        </div>
                        <div class="item-controls">
                            <button class="qty-btn" onclick="changeQty(${idx}, -1)">-</button>
                            <span class="qty-display">${item.qty}</span>
                            <button class="qty-btn" onclick="changeQty(${idx}, 1)">+</button>
                        </div>
                        <div class="item-price">‚Ç∫${(
                          item.price * item.qty
                        ).toFixed(2)}</div>
                        <button class="delete-btn" onclick="removeItem(${idx})">&times;</button>
                    </div>
                `
            )
            .join("");
        }

        updateTotals();
      }

      function changeQty(idx, delta) {
        const table = state.tables[state.selectedTable];
        table.orders[idx].qty += delta;

        if (table.orders[idx].qty <= 0) {
          table.orders.splice(idx, 1);
        }

        calculateTableTotal();
        renderOrderItems();
        renderTables();
        saveState();
      }

      function removeItem(idx) {
        const table = state.tables[state.selectedTable];
        table.orders.splice(idx, 1);
        calculateTableTotal();
        renderOrderItems();
        renderTables();
        saveState();
        showToast("√úr√ºn silindi", "success");
      }

      function calculateTableTotal() {
        const table = state.tables[state.selectedTable];
        table.total = table.orders.reduce(
          (sum, item) => sum + item.price * item.qty,
          0
        );
      }

      function updateTotals() {
        const table = state.tables[state.selectedTable];
        const subtotal = table.total;

        document.getElementById("subtotal").textContent = `‚Ç∫${subtotal.toFixed(
          2
        )}`;
        document.getElementById(
          "grandTotal"
        ).textContent = `‚Ç∫${subtotal.toFixed(2)}`;
      }

      function openProductModal() {
        if (!state.selectedTable) {
          alert("L√ºtfen √∂nce bir masa se√ßin");
          return;
        }
        document.getElementById("productModal").style.display = "flex";
        document.getElementById("orderNote").value = "";
      }

      function closeProductModal() {
        document.getElementById("productModal").style.display = "none";
      }

      function renderCategoryTabs() {
        const container = document.getElementById("categoryTabs");
        container.innerHTML = Object.keys(PRODUCTS)
          .map(
            (cat) => `
                <button class="category-tab ${
                  cat === currentCategory ? "active" : ""
                }" 
                        onclick="switchCategory('${cat}')">
                    ${cat}
                </button>
            `
          )
          .join("");
      }

      function switchCategory(cat) {
        currentCategory = cat;
        // Kategori deƒüi≈üince aramayƒ± temizle
        document.getElementById("searchInput").value = "";
        renderCategoryTabs();
        renderProducts();
      }

      function renderProducts() {
        const grid = document.getElementById("productsGrid");
        grid.innerHTML = PRODUCTS[currentCategory]
          .map(
            (product) => `
                <div class="product-card" onclick='addProduct(${JSON.stringify(
                  product
                )})'>
                    <span class="product-emoji">${product.emoji}</span>
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">‚Ç∫${product.price}</div>
                </div>
            `
          )
          .join("");
      }

      // --- ARAMA Fƒ∞LTRELEME FONKSƒ∞YONU ---
      function filterProducts() {
        const searchText = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const productCards = document.querySelectorAll(".product-card");

        productCards.forEach((card) => {
          const productName = card
            .querySelector(".product-name")
            .textContent.toLowerCase();

          if (productName.includes(searchText)) {
            card.style.display = "block";
          } else {
            card.style.display = "none";
          }
        });
      }

      function addProduct(product) {
        const note = document.getElementById("orderNote").value;
        const table = state.tables[state.selectedTable];

        const existing = table.orders.find(
          (o) => o.name === product.name && o.note === note
        );

        if (existing) {
          existing.qty++;
        } else {
          table.orders.push({
            ...product,
            qty: 1,
            note: note,
          });
        }

        calculateTableTotal();
        renderOrderItems();
        renderTables();
        saveState();
        showToast(`${product.name} eklendi`, "success");
      }

      async function completeOrder() {
        if (!state.selectedTable) return;

        const table = state.tables[state.selectedTable];
        if (table.orders.length === 0) {
          alert("Sepet bo≈ü, √∂deme alƒ±namaz");
          return;
        }

        const orderData = {
          tableId: state.selectedTable,
          items: [...table.orders],
          total: table.total,
          timestamp: new Date().toISOString(),
        };

        state.history.push(orderData);
        state.dailyStats.revenue += table.total;
        state.dailyStats.orders++;

        table.orders = [];
        table.total = 0;

        await saveState();

        renderOrderItems();
        renderTables();
        updateStats();
        showToast(
          `Masa ${state.selectedTable} √∂deme alƒ±ndƒ±: ‚Ç∫${orderData.total.toFixed(
            2
          )}`,
          "success"
        );
      }

      function clearTable() {
        if (!state.selectedTable) return;

        const table = state.tables[state.selectedTable];
        if (table.orders.length === 0) return;

        if (
          !confirm(
            "Bu masanƒ±n sipari≈ülerini iptal etmek istediƒüine emin misin?"
          )
        )
          return;

        table.orders = [];
        table.total = 0;

        renderOrderItems();
        renderTables();
        saveState();
        showToast("Sipari≈ü iptal edildi", "error");
      }

      function updateStats() {
        const activeTables = Object.values(state.tables).filter(
          (t) => t.orders.length > 0
        ).length;
        document.getElementById("activeTables").textContent = activeTables;
        document.getElementById(
          "dailyRevenue"
        ).textContent = `‚Ç∫${state.dailyStats.revenue.toFixed(0)}`;

        // Reports
        document.getElementById(
          "totalSales"
        ).textContent = `‚Ç∫${state.dailyStats.revenue.toFixed(2)}`;
        document.getElementById("totalOrders").textContent =
          state.dailyStats.orders;

        const avgCheck =
          state.dailyStats.orders > 0
            ? state.dailyStats.revenue / state.dailyStats.orders
            : 0;
        document.getElementById("avgCheck").textContent = `‚Ç∫${avgCheck.toFixed(
          2
        )}`;

        // Top product calculation
        const productCounts = {};
        state.history.forEach((order) => {
          order.items.forEach((item) => {
            productCounts[item.name] =
              (productCounts[item.name] || 0) + item.qty;
          });
        });

        const topProduct = Object.entries(productCounts).sort(
          (a, b) => b[1] - a[1]
        )[0];

        document.getElementById("topProduct").textContent = topProduct
          ? `${topProduct[0]} (${topProduct[1]} adet)`
          : "-";
      }

      function renderHistory() {
        const container = document.getElementById("historyList");

        if (state.history.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p>Hen√ºz sipari≈ü ge√ßmi≈üi yok</p>
                    </div>
                `;
          return;
        }

        container.innerHTML = state.history
          .slice()
          .reverse()
          .map((order, idx) => {
            const date = new Date(order.timestamp);
            return `
                    <div style="border-bottom: 1px solid #f1f5f9; padding: 15px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="font-weight: 600; color: #333;">Masa ${
                              order.tableId
                            }</span>
                            <span style="font-family: 'Roboto Mono', monospace; font-weight: 700; color: #667eea;">‚Ç∫${order.total.toFixed(
                              2
                            )}</span>
                        </div>
                        <div style="font-size: 12px; color: #94a3b8; margin-bottom: 8px;">
                            ${date.toLocaleDateString(
                              "tr-TR"
                            )} ${date.toLocaleTimeString("tr-TR")}
                        </div>
                        <div style="font-size: 13px; color: #64748b; line-height: 1.4;">
                            ${order.items
                              .map((item) => `${item.name} (${item.qty})`)
                              .join(", ")}
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      function switchView(view) {
        state.currentView = view;

        const buttons = document.querySelectorAll(".menu-btn");
        buttons.forEach((btn) => btn.classList.remove("active"));
        event.currentTarget.classList.add("active");

        if (view === "tables") {
          document.getElementById("tablesView").style.display = "block";
          document.getElementById("reportsView").style.display = "none";
        } else if (view === "reports") {
          document.getElementById("tablesView").style.display = "none";
          document.getElementById("reportsView").style.display = "block";
          renderHistory();
        }
      }

      async function resetAllData() {
        if (!confirm("T√úM VERƒ∞LER Sƒ∞Lƒ∞NECEK! Emin misiniz?")) return;

        try {
          localStorage.removeItem("restaurant_state");
          state = {
            tables: {},
            selectedTable: null,
            currentView: "tables",
            history: [],
            dailyStats: { revenue: 0, orders: 0 },
          };

          for (let i = 1; i <= 12; i++) {
            state.tables[i] = { orders: [], total: 0 };
          }

          await saveState();
          renderTables();
          updateStats();
          document.getElementById("orderPanel").style.display = "none";
          showToast("Sistem sƒ±fƒ±rlandƒ±", "success");
        } catch (e) {
          console.error("Sƒ±fƒ±rlama hatasƒ±:", e);
        }
      }

      function showToast(message, type = "success") {
        console.log(`Bildirim (${type}): ${message}`);
      }

      init();
    </script>
  </body>
</html>
